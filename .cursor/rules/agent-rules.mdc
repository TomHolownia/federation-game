---
description: Agent workflow - Non-negotiable before any work
globs: **/*
alwaysApply: true
---

# Agent Workflow

## Gate: Before ANY file edits

**Ask:** Am I in a worktree, on a branch, that exists for *this* change?

- **No** → Create worktree + branch first. Never edit in the main repo or another task's worktree.
- **Yes** → Proceed.

---

## Two paths

**1. Task from Confluence** (task board → worktree → work → PR)
- Pick a task from Ready. Create worktree: `git worktree add .worktrees/federation-game-FED-XXX -b feature/FED-XXX-desc origin/main`
- Work in the worktree. Commit: `[FED-XXX] Description`. Push, create PR.

**2. Small change (no Confluence ticket)**
- No ticket is fine. You still use a worktree + branch.
- Create worktree: `git worktree add .worktrees/federation-game-<topic> -b feature/<topic> origin/main`
- Work there. Commit, push, create PR.

---

## Never

- Edit in the main repo directory
- Edit on a branch that belongs to a different change
- Push to main (use PRs)
- Force push to protected branches
- Commit secrets (use env for Atlassian tokens)

---

## Commit format

- With ticket: `[FED-XXX] Short description (50 chars max)`
- No ticket: `Short description (50 chars max)`

## While working

- Search before creating (`rg "pattern"`)
- Match existing style
- Commit frequently
- Write tests for new C++ code

## Testing (main worktree)

Test changes on the **main worktree** (repo root): that's where the uproject and cached files live. You cannot have the same branch checked out in two worktrees. When the worktree work is ready to test: push the branch, remove the worktree, switch the main worktree to that branch, pull, then suggest project reload or hot reload in the editor.

## Quick ref

```bash
git worktree list
git worktree add .worktrees/federation-game-<name> -b feature/<name> origin/main
gh pr create
```

## Safety

- Never commit secrets (Atlassian tokens → env only)
- Use Git LFS for *.uasset, *.umap, *.png
